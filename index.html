<!DOCTYPE html>
<html>
<head>
  <title>Lonnie's KB Search</title>
  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.1">

  <style>
	  
	body {
	  margin: 0;
	  font-family: "Segoe UI", Roboto, Arial, sans-serif;
	  font-size: 18px;
	  line-height: 1.5;
	  background: linear-gradient(135deg, #f4f6f9, #e9edf3);
	  color: #1f2937;
	}
	
	.header {
	  background: #0A1F44;
	  padding: 60px 40px;
	  border-bottom: 1px solid #e5e7eb;
	}
	
	.header-inner {
	  max-width: 900px;
	  margin: 0 auto;
	}
	
	.header h1 {
	  margin: 0 0 24px 0;
	  font-size: 40px;
	  font-weight: 600;
	  color: #ffffff;
	}
	
	.content {
	  max-width: 900px;
	  margin: 40px auto;
	  padding: 0 40px 60px;
	  background: #ffffff;
	  border-radius: 10px;
	}
		
	.search-row {
	  display: flex;
	  gap: 10px;
	  margin-top: 20px;
	}
	
	input {
	  flex: 1;
	  font-size: 18px;
	  padding: 12px 14px;
	  border-radius: 6px;
	  border: 1px solid #cbd5e1;
	}
	
	button {
	  font-size: 18px;
	  padding: 12px 20px;
	  border-radius: 6px;
	  border: none;
	  background: #2563eb;
	  color: white;
	  cursor: pointer;
	}
	
	button:hover {
	  background: #1e4ed8;
	}
	
	hr {
	  margin: 30px 0;
	  border: none;
	  border-top: 1px solid #e5e7eb;
	}

   </style>
</head>

<body>

<div id="loading-msg" style="
  background:#fff3cd;
  border-bottom:1px solid #ffeeba;
  color:#856404;
  padding:12px 16px;
  text-align:center;
  font-size:16px;
">
  <strong>Loading Knowledge Base service…</strong><br>
  Please allow up to 30–60 seconds on first access.
</div>

<div class="header">
  <div class="header-inner">
    <h1>Lonnie's KB Search</h1>

    <div class="search-row">
      <input id="q"
             placeholder="Type your question here"
             onkeydown="if (event.key === 'Enter') search();">

      <button onclick="search()">Search</button>
    </div>
  </div>
</div>

<div class="content">
  <div id="out"></div>
</div>
	
<script>
function highlight(text, term) {
  if (!term) return text;

  // remove trailing 's' if present
  const base = term.toLowerCase().endsWith("s")
    ? term.slice(0, -1)
    : term;
  // match singular OR plural
  const regex = new RegExp(`\\b(${base}s?)\\b`, "gi");
  return text.replace(
    regex,
    //`<span style="background-color: yellow; font-weight: bold;">$1</span>`
    `<span style="background-color:#fee2e2; color:#7f1d1d; font-weight:600; padding:2px 4px; border-radius:3px;">$1</span>`
  );
}


async function search() {
  const q = document.getElementById("q").value;
  const r = await fetch(`/search?q=${encodeURIComponent(q)}`);
  const data = await r.json();

  let output = "";

  if (!data || data.length === 0) {
    output = "<p>No match found</p>";
  } else {
	  
	data.forEach((item, i) => {
	  const term = q;
	
	  output += `
	    <details style="margin-bottom:16px;">
	      <summary style="cursor:pointer; font-weight:bold;">
	        ${i + 1}. ${highlight(item.question, term)}
	      </summary>
	
	      <div style="margin-top:10px; padding-left:10px;">
	        ${highlight(item.answer, term)}
	  `;
	
	  if (item.images && item.images.length > 0) {
	    item.images.forEach(img => {
	      output += `
	        <img src="/images/${img}"
	             style="max-width:800px; display:block; margin:10px 0;">
	      `;
	    });
	  }
	
	  output += `
	      </div>
	    </details>
	  `;
	});
  
  }

  document.getElementById("out").innerHTML = output;
}

// Hide loading message once page finishes loading
window.addEventListener("load", () => {
  const msg = document.getElementById("loading-msg");
  if (msg) msg.style.display = "none";
});

</script>

</body>
</html>














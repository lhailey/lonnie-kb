<!DOCTYPE html>
<html>
<head>
  <title>RTLS Operations Knowledge Base</title>
  <meta charset="utf-8">

  <style>
    mark {
      background-color: yellow;
      color: black;
      font-weight: bold;
      padding: 0 2px;
    }
  </style>
</head>

<body>

<h2>RTLS Operations Knowledge Base</h2>

<input id="q"
       style="width:600px"
       placeholder="Type your question here"
       onkeydown="if (event.key === 'Enter') search();">

<button onclick="search()">Search</button>

<hr>

<div id="out"></div>

<script>
function highlight(text, term) {
  if (!term) return text;

  const regex = new RegExp(`(${term})`, "gi");
  return text.replace(
    regex,
    `<mark style="font-weight:bold;">$1</mark>`
  );

}

async function search() {
  const raw = document.getElementById("q").value;
  const q = raw.replace(/s$/i, "");
  const r = await fetch(`/search?q=${encodeURIComponent(q)}`);
  const data = await r.json();

  let output = "";

  if (!data || data.length === 0) {
    output = "<p>No match found</p>";
  } else {
    data.forEach((item, i) => {
      output += `<h3>Result ${i + 1}</h3>`;
      output += `<strong>Question:</strong><br>`;
      output += `${highlight(item.question, q)}<br><br>`;
      output += `<strong>Answer:</strong><br>`;
      output += `${highlight(item.answer, q)}<br><br>`;

      if (item.images && item.images.length > 0) {
        item.images.forEach(img => {
          output += `<img src="/images/${img}" style="max-width:800px; display:block; margin-bottom:20px;">`;
        });
      }

      output += `<hr>`;
    });
  }

  document.getElementById("out").innerHTML = output;
}
</script>

</body>
</html>




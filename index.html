<!DOCTYPE html>
<html>
<head>
  <title>Lonnie's KB Search</title>
  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.1">

  <style>
    body {
      font-size: 18px;
    }

    input {
      font-size: 18px;
    }

    button {
      font-size: 18px;
    }
   </style>
</head>

<body>

<h2>Lonnie's KB Search</h2>
<input id="q"
       style="width:600px"
       placeholder="Type your question here"
       onkeydown="if (event.key === 'Enter') search();">

<button onclick="search()">Search</button>

<hr>

<div id="out"></div>

<script>
function highlight(text, term) {
  if (!term) return text;

  // remove trailing 's' if present
  const base = term.toLowerCase().endsWith("s")
    ? term.slice(0, -1)
    : term;

  // match singular OR plural
  const regex = new RegExp(`\\b(${base}s?)\\b`, "gi");

  return text.replace(
    regex,
    `<span style="background-color: yellow; font-weight: bold;">$1</span>`
  );
}


async function search() {
  const q = document.getElementById("q").value;
  const r = await fetch(`/search?q=${encodeURIComponent(q)}`);
  const data = await r.json();

  let output = "";

  if (!data || data.length === 0) {
    output = "<p>No match found</p>";
  } else {
    data.forEach((item, i) => {
      output += `<h3>Result ${i + 1}</h3>`;
	  
	  const term = q;

	  output += `<strong>Question:</strong> ${highlight(item.question, term)}<br><br>`;
	  output += `<strong>Answer:</strong><br>${highlight(item.answer, term)}<br><br>`;


      if (item.images && item.images.length > 0) {
        item.images.forEach(img => {
          output += `<img src="/images/${img}" style="max-width:800px; display:block; margin-bottom:20px;">`;
        });
      }

      output += `<hr>`;
    });
  }

  document.getElementById("out").innerHTML = output;
}
</script>

</body>
</html>


